<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Distributed Reconstruction · MPIReco</title><meta name="title" content="Distributed Reconstruction · MPIReco"/><meta property="og:title" content="Distributed Reconstruction · MPIReco"/><meta property="twitter:title" content="Distributed Reconstruction · MPIReco"/><meta name="description" content="Documentation for MPIReco."/><meta property="og:description" content="Documentation for MPIReco."/><meta property="twitter:description" content="Documentation for MPIReco."/><meta property="og:url" content="https://github.com/MagneticParticleImaging/MPIReco.jl/generated/tutorials/distributed/"/><meta property="twitter:url" content="https://github.com/MagneticParticleImaging/MPIReco.jl/generated/tutorials/distributed/"/><link rel="canonical" href="https://github.com/MagneticParticleImaging/MPIReco.jl/generated/tutorials/distributed/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="MPIReco logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">MPIReco</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../overview/">Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox" checked/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../basicReconstruction/">Basic Reconstructions</a></li><li><a class="tocitem" href="../weighting/">Weighting</a></li><li><a class="tocitem" href="../multiContrast/">Multi-Contrast</a></li><li><a class="tocitem" href="../matrixCompression/">Compression</a></li><li><a class="tocitem" href="../multiPatch/">Multi-Patch</a></li><li><a class="tocitem" href="../lowlevel/">Low-Level</a></li><li><a class="tocitem" href="../gpuAcceleration/">GPU-Acceleration</a></li><li class="is-active"><a class="tocitem" href>Distributed Reconstruction</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../howtos/solvers/">Change and Configure Solvers</a></li><li><a class="tocitem" href="../../howtos/caching/">Enable Caching</a></li><li><a class="tocitem" href="../../howtos/callbacks/">Use Callbacks</a></li><li><a class="tocitem" href="../../howtos/custom/">Implement Custom Data Processing</a></li><li><a class="tocitem" href="../../howtos/extensions/">Implement Reconstruction Packages</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../datastructures/">Data Structures</a></li><li><a class="tocitem" href="../../explanations/recoplans/">MPIRecoPlan</a></li><li><a class="tocitem" href="../../explanations/operators/">Imaging Operators</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../references/utility/">Utility</a></li><li><a class="tocitem" href="../../../references/parameters/">Parameters</a></li><li><a class="tocitem" href="../../../references/singlepatch/">Single-Patch</a></li><li><a class="tocitem" href="../../../references/multipatch/">Multi-Patch</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Distributed Reconstruction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Distributed Reconstruction</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MagneticParticleImaging/MPIReco.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/MagneticParticleImaging/MPIReco.jl/blob/master/docs/src/literate/tutorials/distributed.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Distributed-Image-Reconstruction"><a class="docs-heading-anchor" href="#Distributed-Image-Reconstruction">Distributed Image Reconstruction</a><a id="Distributed-Image-Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Distributed-Image-Reconstruction" title="Permalink"></a></h1><p>MPIReco image reconstructions can also be executed across different computers, thanks to <a href="https://github.com/JuliaImageRecon/DaggerImageReconstruction.jl">DaggerImageReconstruction</a>. With this feature one could perform a reconstruction over the network on a machine with some specific resource, be it a specific system matrix or access to a GPU.</p><p>To enable a distributed reconstruction one has to first use the Distributed standard library to add a new Julia process on the remote machine.</p><pre><code class="language-julia hljs">using Distributed
workers = addprocs([&quot;remote_address])
worker = first(workers)</code></pre><pre><code class="language-julia hljs">worker = 1 #hide # comment out to properly connect to a different process</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">1</code></pre><p>The worker is the Julia process id, which is used to identify where to move data to and perform computations on. Afterwards we just load both MPIReco and DaggerImageReconstruction:</p><pre><code class="language-julia hljs">using MPIReco, DaggerImageReconstruction</code></pre><p>Instead of a MPIFile, we now want to create a DMPIFile, a distributed MPIFIle. Such a file expects a path on the remote machine together with the worker id:</p><pre><code class="language-julia hljs">distr_bSF = DMPIFile(joinpath(datadir, &quot;calibrations&quot;, &quot;12.mdf&quot;), worker = worker)
distr_b = DMPIFile(joinpath(datadir, &quot;measurements&quot;, &quot;20211226_203916_MultiPatch&quot;, &quot;1.mdf&quot;), worker = worker)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">DMPIFile{MDFFileV2{Base.ReshapedArray{Int32, 4, Base.ReinterpretArray{Int32, 1, UInt8, Vector{UInt8}, false}, Tuple{}}}}
	Study: &quot;FocusField&quot;, Dates.DateTime(&quot;2014-11-13T16:20:01.217&quot;)
	Experiment: &quot;Ph5DotsDF10Overlap0LL (E99)&quot;, Dates.DateTime(&quot;2014-11-27T14:40:01.280&quot;)
</code></pre><p>Note that you might need to consider differences between the operating systems of both machines. For example, in this case we constructing our filepath locally, while evaluating it on the remote. You could also construct the path on the worker with:</p><pre><code class="language-julia hljs">remotecall_fetch(() -&gt; joinpath(&quot;...&quot;), worker)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;...&quot;</code></pre><p>Once we have our distributed files, we can configure our reconstruction like usual and the algorithm figures out on which worker to execute based on the provided distributed MPIFiles. In this case, both files were located on the remote. If the measurements are located on the local machine, then one has to transfer the data over the network.</p><pre><code class="language-julia hljs">c1 = reconstruct(&quot;SinglePatch&quot;, distr_b;
                   SNRThresh=5,
                   sf = distr_bSF,
                   frames=1:acqNumFrames(distr_b),
                   minFreq=80e3,
                   recChannels=1:rxNumChannels(distr_b),
                   iterations=1,
                   spectralLeakageCorrection=true);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Loading SM
[ Info: Preparing SF
[ Info: Adapting SF</code></pre><p>Most MPIFiles instances are just handles to one or more local files and thus can&#39;t be meaningfully send over the network. To get around this, you can transform an MDF into an MDFinMemory, which is a fully in-memory representation of an MDF.</p><pre><code class="language-julia hljs">b = MPIFile(joinpath(datadir, &quot;measurements&quot;, &quot;20211226_203916_MultiPatch&quot;, &quot;1.mdf&quot;))
bInMemory = MDFv2InMemory(b)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">MPIFile
	Study: &quot;FocusField&quot;, Dates.DateTime(&quot;2014-11-13T16:20:01.217&quot;)
	Experiment: &quot;Ph5DotsDF10Overlap0LL (E99)&quot;, Dates.DateTime(&quot;2014-11-27T14:40:01.280&quot;)
</code></pre><p>Now the algorithm can&#39;t determinte the worker from the measurement anymore and we have to utilize the <code>loadDaggerPlan</code> function from DaggerImageReconstruction. This function expects a path to a local RecoPlan, which is then constructed on the given worker:</p><pre><code class="language-julia hljs">planpaths = getRecoPlanList(;full=true)
index = findfirst(endswith(&quot;SinglePatch.toml&quot;), planpaths)
distr_plan = loadDaggerPlan(planpaths[index], getRecoPlanModules(), worker = 1)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RecoPlan{DaggerReconstructionAlgorithm}
└─ parameter::RecoPlan{DaggerReconstructionParameter}
   └─ algo::RecoPlan{SinglePatchReconstructionAlgorithm} [Distributed, Worker 1]
      └─ parameter::RecoPlan{SinglePatchParameters}
         ├─ reco::RecoPlan{SinglePatchReconstructionParameter}
         │  ├─ solverParams::RecoPlan{ElaborateSolverParameters}
         │  │  ├─ solver
         │  │  ├─ iterations
         │  │  ├─ enforceReal
         │  │  ├─ enforcePositive
         │  │  ├─ callbacks
         │  │  ├─ normalizeReg
         │  │  ├─ randomized
         │  │  ├─ subMatrixFraction
         │  │  ├─ shuffleRows
         │  │  └─ seed
         │  ├─ weightingParams::RecoPlan{NoWeightingParameters} [Cached, 1]
         │  ├─ reg
         │  ├─ sf
         │  ├─ arrayType
         │  └─ sfLoad::RecoPlan{DenseSystemMatixLoadingParameter} [Cached, 3]
         │     ├─ tfCorrection
         │     ├─ loadasreal
         │     ├─ freqFilter::RecoPlan{SNRThresholdFrequencyFilterParameter}
         │     │  ├─ numPeriodAverages
         │     │  ├─ numPeriodGrouping
         │     │  ├─ maxMixingOrder
         │     │  ├─ numSidebandFreqs
         │     │  ├─ SNRThresh
         │     │  ├─ minFreq
         │     │  ├─ recChannels
         │     │  └─ maxFreq
         │     ├─ bgCorrection
         │     └─ gridding::RecoPlan{SystemMatrixGriddingParameter}
         │        ├─ fov
         │        ├─ deadPixels
         │        ├─ gridsize
         │        └─ center
         ├─ post::RecoPlan{NoPostProcessing}
         └─ pre::RecoPlan{CommonPreProcessingParameters} [Cached, 1]
            ├─ tfCorrection
            ├─ neglectBGFrames
            ├─ numPeriodAverages
            ├─ numPeriodGrouping
            ├─ numAverages
            ├─ spectralLeakageCorrection
            ├─ bgParams
            ├─ frames
            └─ loadasreal
</code></pre><p>We can then configure the plan as usual:</p><pre><code class="language-julia hljs">setAll!(distr_plan; SNRThresh=5,
                   sf = distr_bSF,
                   frames=1:acqNumFrames(bInMemory),
                   minFreq=80e3,
                   recChannels=1:rxNumChannels(bInMemory),
                   iterations=1,
                   spectralLeakageCorrection=true)</code></pre><p>And perform a normal reconstruction with it:</p><pre><code class="language-julia hljs">distr_algo = build(distr_plan)
c2 = reconstruct(distr_algo, bInMemory)
isapprox(c1.data.data, c2.data.data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../gpuAcceleration/">« GPU-Acceleration</a><a class="docs-footer-nextpage" href="../../howtos/solvers/">Change and Configure Solvers »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 7 August 2025 09:30">Thursday 7 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
