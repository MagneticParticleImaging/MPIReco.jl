<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Implement Custom Data Processing · MPIReco</title><meta name="title" content="Implement Custom Data Processing · MPIReco"/><meta property="og:title" content="Implement Custom Data Processing · MPIReco"/><meta property="twitter:title" content="Implement Custom Data Processing · MPIReco"/><meta name="description" content="Documentation for MPIReco."/><meta property="og:description" content="Documentation for MPIReco."/><meta property="twitter:description" content="Documentation for MPIReco."/><meta property="og:url" content="https://github.com/MagneticParticleImaging/MPIReco.jl/generated/howtos/custom/"/><meta property="twitter:url" content="https://github.com/MagneticParticleImaging/MPIReco.jl/generated/howtos/custom/"/><link rel="canonical" href="https://github.com/MagneticParticleImaging/MPIReco.jl/generated/howtos/custom/"/><script data-outdated-warner src="../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../assets/documenter.js"></script><script src="../../../search_index.js"></script><script src="../../../siteinfo.js"></script><script src="../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../"><img src="../../../assets/logo.png" alt="MPIReco logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../">MPIReco</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../">Home</a></li><li><a class="tocitem" href="../../tutorials/overview/">Getting Started</a></li><li><input class="collapse-toggle" id="menuitem-3" type="checkbox"/><label class="tocitem" for="menuitem-3"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/basicReconstruction/">Basic Reconstructions</a></li><li><a class="tocitem" href="../../tutorials/weighting/">Weighting</a></li><li><a class="tocitem" href="../../tutorials/multiContrast/">Multi-Contrast</a></li><li><a class="tocitem" href="../../tutorials/matrixCompression/">Compression</a></li><li><a class="tocitem" href="../../tutorials/multiPatch/">Multi-Patch</a></li><li><a class="tocitem" href="../../tutorials/lowlevel/">Low-Level</a></li><li><a class="tocitem" href="../../tutorials/gpuAcceleration/">GPU-Acceleration</a></li><li><a class="tocitem" href="../../tutorials/distributed/">Distributed Reconstruction</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">How to</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../solvers/">Change and Configure Solvers</a></li><li><a class="tocitem" href="../caching/">Enable Caching</a></li><li><a class="tocitem" href="../callbacks/">Use Callbacks</a></li><li class="is-active"><a class="tocitem" href>Implement Custom Data Processing</a><ul class="internal"><li><a class="tocitem" href="#Custom-Processing-Steps"><span>Custom Processing Steps</span></a></li><li><a class="tocitem" href="#Custom-Reconstruction-Algorithms"><span>Custom Reconstruction Algorithms</span></a></li></ul></li><li><a class="tocitem" href="../extensions/">Implement Reconstruction Packages</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-5" type="checkbox"/><label class="tocitem" for="menuitem-5"><span class="docs-label">Explanations</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../datastructures/">Data Structures</a></li><li><a class="tocitem" href="../../explanations/recoplans/">MPIRecoPlan</a></li><li><a class="tocitem" href="../../explanations/operators/">Imaging Operators</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Reference</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../references/utility/">Utility</a></li><li><a class="tocitem" href="../../../references/parameters/">Parameters</a></li><li><a class="tocitem" href="../../../references/singlepatch/">Single-Patch</a></li><li><a class="tocitem" href="../../../references/multipatch/">Multi-Patch</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">How to</a></li><li class="is-active"><a href>Implement Custom Data Processing</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Implement Custom Data Processing</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/MagneticParticleImaging/MPIReco.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/MagneticParticleImaging/MPIReco.jl/blob/master/docs/src/literate/howtos/custom.jl" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Custom-Data-Processing-and-Algorithms"><a class="docs-heading-anchor" href="#Custom-Data-Processing-and-Algorithms">Custom Data Processing and Algorithms</a><a id="Custom-Data-Processing-and-Algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Data-Processing-and-Algorithms" title="Permalink"></a></h1><p>This how-to provides a quick guide on how to customize reconstruction algorithms. For more information on how to extend algorithms and processing steps, we refer to the Explanations section of the documentation and to the example section of AbstractImageReconstructions documentation.</p><h2 id="Custom-Processing-Steps"><a class="docs-heading-anchor" href="#Custom-Processing-Steps">Custom Processing Steps</a><a id="Custom-Processing-Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Processing-Steps" title="Permalink"></a></h2><p>To implement a custom processing step, we need to add a new parameter struct, in our case we want to extend <code>AbstractWeightingParameters</code>. As a toy-example, we will implement a weighting strategy in which frequencies are weighting with an alternating sequence of weights:</p><pre><code class="language-julia hljs">Base.@kwdef struct AlternatingWeightingParameters &lt;: AbstractWeightingParameters
  alternatingWeights::Vector{Float64}
end</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.AlternatingWeightingParameters</code></pre><p>The <code>Base.@kwdef</code> macro generates a keyword-argment constructor with optional default values. Next, we can implement the actual processing function.</p><p>Different algorithms can have different implementations of a given weighting strategy and we can specialise a function on the type of algorithm or an algorithm instance itself. The former is helpful for pure functions, i.e. processing steps which solely depend on the given parameter and processing-arguments, not the state of the algorithm. The generic weight-process function takes as input the frequencies and the system matrix operator. In our case we only require the frequencies:</p><pre><code class="language-julia hljs">function AbstractImageReconstruction.process(::Type{&lt;:AbstractMPIRecoAlgorithm}, params::AlternatingWeightingParameters, freqs::Vector{CartesianIndex{2}}, args...)
  alternatingWeights = Iterators.cycle(params.alternatingWeights) # Infinitely cycle through our weights
  weights = collect(Iterators.take(alternatingWeights, length(freqs)))
  return weights
end</code></pre><p>After implementing our processing function, we can directly use it within our exisintg algorithm blueprints:</p><pre><code class="language-julia hljs">params = Dict{Symbol, Any}()
params[:SNRThresh] = 5
params[:frames] = 1:1
params[:minFreq] = 80e3
params[:recChannels] = 1:2
params[:spectralLeakageCorrection] = true
params[:sf] = bSF
params[:reg] = [L2Regularization(0.1f0)]

ourWeighting = AlternatingWeightingParameters(collect(range(0.0, 1.0, length=5)))</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">Main.AlternatingWeightingParameters([0.0, 0.25, 0.5, 0.75, 1.0])</code></pre><p>We can use either the high-level interface:</p><pre><code class="language-julia hljs">c1 = reconstruct(&quot;SinglePatch&quot;, b; params..., weightingParams = ourWeighting);</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">[ Info: Loading SM
[ Info: Preparing SF
[ Info: Adapting SF</code></pre><p>Or the RecoPlan interface:</p><pre><code class="language-julia hljs">plan = MPIRecoPlan(&quot;SinglePatch&quot;)
setAll!(plan, params)
setAll!(plan, :weightingParams, ourWeighting)
algo = build(plan)
c2 = reconstruct(algo, b)
isapprox(c1.data.data, c2.data.data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>We can visualize the results of our weighting:</p><pre><code class="language-julia hljs">using CairoMakie
fig = heatmap(c1[1, :, :, 1, 1].data.data)
hidedecorations!(fig.axis)
fig</code></pre><img src="data:image/png;base64,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AADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUDnvcRAAAAAHinAQAAAIBhzQ/dewMAAAAAnzQAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY1gAAAADAsAYAAAAAhjUAAAAAMKwBAAAAgGENAAAAAAxrAAAAAGBYAwAAAADDGgAAAAAY9gKGEIVJnYJZiQAAAABJRU5ErkJggg==" alt="Example block output"/><p>The <code>SinglePatch</code> algorithm which we adapted with our new weighting strategy, actually allows weighting results to be cached.</p><pre><code class="language-julia hljs">plan = MPIRecoPlan(&quot;SinglePatch&quot;)
typeof(plan.parameter.reco.weightingParams)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">RecoPlan{ProcessResultCache}</code></pre><p>By overwritting the weightingParams, we removed the caching layer. If we want to use our adapted reconstruction algoritm with the best performace, we have to retain the caching layer:</p><pre><code class="language-julia hljs">plan.parameter.reco.weightingParams.param = ourWeighting
setAll!(plan, params)
algo = build(plan)
c3 = reconstruct(algo, b)
isapprox(c1.data.data, c3.data.data)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">true</code></pre><p>We can then turn out algorithm into a plan and store it somewhere:</p><pre><code class="language-julia hljs">plan = toPlan(algo)
AbstractImageReconstruction.clear!(plan)
toTOML(stdout, plan)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">┌ Warning: Could not set all `rho` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `absTol` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `relTol` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `regTrafo` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `greedy_randomized` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `tolInner` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `iterationsInner` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `restart` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `kwargWarning` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `iterationsCG` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `vary_rho` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
┌ Warning: Could not set all `theta` properties of plan: Property not found
└ @ AbstractImageReconstruction ~/.julia/packages/AbstractImageReconstruction/p34NN/src/RecoPlans/RecoPlans.jl:141
_module = &quot;MPIReco&quot;
_type = &quot;RecoPlan{SinglePatchReconstructionAlgorithm}&quot;

[parameter]
_module = &quot;MPIReco&quot;
_type = &quot;RecoPlan{SinglePatchParameters}&quot;

    [parameter.reco]
    _module = &quot;MPIReco&quot;
    _type = &quot;RecoPlan{SinglePatchReconstructionParameter}&quot;

        [parameter.reco.sfLoad]
        _module = &quot;AbstractImageReconstruction&quot;
        _type = &quot;RecoPlan{ProcessResultCache}&quot;

            [parameter.reco.sfLoad.param]
            _module = &quot;MPIReco&quot;
            _type = &quot;RecoPlan{DenseSystemMatixLoadingParameter}&quot;

                [parameter.reco.sfLoad.param.freqFilter]
                _module = &quot;MPIReco&quot;
                _type = &quot;RecoPlan{SNRThresholdFrequencyFilterParameter}&quot;

                [parameter.reco.sfLoad.param.gridding]
                _module = &quot;MPIReco&quot;
                _type = &quot;RecoPlan{SystemMatrixGriddingParameter}&quot;

        [parameter.reco.weightingParams]
        _module = &quot;AbstractImageReconstruction&quot;
        _type = &quot;RecoPlan{ProcessResultCache}&quot;

            [parameter.reco.weightingParams.param]
            _module = &quot;Main&quot;
            _type = &quot;RecoPlan{Main.AlternatingWeightingParameters}&quot;

        [parameter.reco.solverParams]
        _module = &quot;MPIReco&quot;
        _type = &quot;RecoPlan{ElaborateSolverParameters}&quot;

    [parameter.pre]
    _module = &quot;AbstractImageReconstruction&quot;
    _type = &quot;RecoPlan{ProcessResultCache}&quot;

        [parameter.pre.param]
        _module = &quot;MPIReco&quot;
        _type = &quot;RecoPlan{CommonPreProcessingParameters}&quot;

            [parameter.pre.param.bgParams]
            _module = &quot;MPIReco&quot;
            _type = &quot;RecoPlan{NoBackgroundCorrectionParameters}&quot;

    [parameter.post]
    _module = &quot;MPIReco&quot;
    _type = &quot;RecoPlan{NoPostProcessing}&quot;</code></pre><p>The How-to on <a href="../extensions/#Implement-Reconstruction-Packages">Implement Reconstruction Packages</a> shows to make such a plan available to the usual MPIReco interfaces.</p><h2 id="Custom-Reconstruction-Algorithms"><a class="docs-heading-anchor" href="#Custom-Reconstruction-Algorithms">Custom Reconstruction Algorithms</a><a id="Custom-Reconstruction-Algorithms-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Reconstruction-Algorithms" title="Permalink"></a></h2><p>So far, we created new &quot;variant&quot; of an image reconstruction algorithm by adding a new strategy of an existing processing step. However, if our new reconstruction algorithm requires overall different data processing, such as for example an X-space reconstruction, we need to implement a new <code>AbstractMPIRecoAlgorithm</code>.</p><p>The AbstractImageReconstruction.jl documentation has examples of full algorithm implementations. We recommend reading those and then reading the implementation of the single-patch reconstruction algorithm as a starting point.</p><hr/><p><em>This page was generated using <a href="https://github.com/fredrikekre/Literate.jl">Literate.jl</a>.</em></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../callbacks/">« Use Callbacks</a><a class="docs-footer-nextpage" href="../extensions/">Implement Reconstruction Packages »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.14.1 on <span class="colophon-date" title="Thursday 7 August 2025 09:30">Thursday 7 August 2025</span>. Using Julia version 1.11.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
