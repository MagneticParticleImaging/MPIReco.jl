<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Basic Reconstruction · MPI Reconstruction</title><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="index.html"><img src="assets/logo.png" alt="MPI Reconstruction logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="index.html">MPI Reconstruction</a></span></div><form class="docs-search" action="search.html"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="index.html">Home</a></li><li><a class="tocitem" href="overview.html">Getting Started</a></li><li class="is-active"><a class="tocitem" href="basicReconstruction.html">Basic Reconstruction</a><ul class="internal"><li><a class="tocitem" href="#On-Disk-Reconstruction"><span>On Disk Reconstruction</span></a></li><li><a class="tocitem" href="#In-Memory-Reconstruction"><span>In Memory Reconstruction</span></a></li><li><a class="tocitem" href="#Middle-Level-Reconstruction"><span>Middle Level Reconstruction</span></a></li><li><a class="tocitem" href="#Low-Level-Reconstruction"><span>Low Level Reconstruction</span></a></li></ul></li><li><a class="tocitem" href="parameters.html">Parameters</a></li><li><a class="tocitem" href="recoResults.html">Results</a></li><li><a class="tocitem" href="multiContrast.html">Multi-Contrast</a></li><li><a class="tocitem" href="multiPatch.html">Multi-Patch</a></li><li><a class="tocitem" href="matrixCompression.html">Compression</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href="basicReconstruction.html">Basic Reconstruction</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href="basicReconstruction.html">Basic Reconstruction</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/MagneticParticleImaging/MPIReco.jl/blob/master/docs/src/basicReconstruction.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Basic-Reconstruction"><a class="docs-heading-anchor" href="#Basic-Reconstruction">Basic Reconstruction</a><a id="Basic-Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Basic-Reconstruction" title="Permalink"></a></h1><p>MPIReco.jl provides different reconstruction levels. All of these reconstruction routines are called <code>reconstruction</code> and the dispatch is done based on the input types.</p><h2 id="On-Disk-Reconstruction"><a class="docs-heading-anchor" href="#On-Disk-Reconstruction">On Disk Reconstruction</a><a id="On-Disk-Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#On-Disk-Reconstruction" title="Permalink"></a></h2><p>This is the highest level reconstruction. The function signature is given by</p><pre><code class="language-julia hljs">function reconstruction(d::MDFDatasetStore, study::Study,
                        exp::Experiment, recoParams::Dict)</code></pre><p>This reconstruction is also called an <em>on disk</em> reconstruction because it assumes that one has a data store (i.e. a structured folder of files) where the file location is uniquely determined by the study name and experiment number. All reconstruction parameters are passed to this method by the <code>recoParams</code> dictionary. On disk reconstruction has the advantage that the routine will perform reconstruction only once for a particular set of parameters. If that parameter set has already been reconstructed, the data will loaded from disk. However, the on disk reconstruction needs some experience with dataset stores to set it up correctly and is not suited for unstructured data.</p><h2 id="In-Memory-Reconstruction"><a class="docs-heading-anchor" href="#In-Memory-Reconstruction">In Memory Reconstruction</a><a id="In-Memory-Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#In-Memory-Reconstruction" title="Permalink"></a></h2><p>The next level is the in memory reconstruction. Its function signature reads</p><pre><code class="language-julia hljs">function reconstruction(recoParams::Dict)</code></pre><p>This routine requires that all parameters are put into a dictionary. An overview how this dictionary looks like is given in the section <a href="parameters.html#Parameters">Parameters</a>.</p><p>The above reconstruction method basically does two things</p><ul><li>Pull out the location of measurement data and system matrix from the <code>recoParams</code> dictionary.</li><li>Pass all parameter to the low level reconstruction method in the form of keyword parameters.</li></ul><p>In turn the next level reconstruction looks like this</p><pre><code class="language-julia hljs">function reconstruction(bSF::MPIFile, bMeas::MPIFile; kargs...)</code></pre><p>There are, however also some reconstruction methods in-between that look like this</p><pre><code class="language-julia hljs">function reconstruction(filenameSF::AbstractString, filenameMeas::AbstractString; kargs...)
function reconstruction(filenameMeas::AbstractString; kargs...)</code></pre><p>In both cases, an MPIFile is created based on the input filename. The second version also guesses the system matrix based on what is stored within the measurement file. This usually only works, if this is executed on a system where the files are stored at exactly the same location as how they have been measured.</p><h2 id="Middle-Level-Reconstruction"><a class="docs-heading-anchor" href="#Middle-Level-Reconstruction">Middle Level Reconstruction</a><a id="Middle-Level-Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Middle-Level-Reconstruction" title="Permalink"></a></h2><p>The middle level reconstruction first checks, whether the dataset is a multi-patch or a single-patch file. Then it will call either <code>reconstructionSinglePatch</code> or <code>reconstructionMultiPatch</code>. Both have essentially the signature</p><pre><code class="language-julia hljs">function reconstructionSinglePatch(bSF::MPIFile, bMeas::MPIFile;
                                  minFreq=0, maxFreq=1.25e6, SNRThresh=-1,
                                  maxMixingOrder=-1, numUsedFreqs=-1, sortBySNR=false, recChannels=1:numReceivers(bMeas),
                                  bEmpty = nothing, bgFrames = 1, fgFrames = 1,
                                  varMeanThresh = 0, minAmplification=2, kargs...)</code></pre><p>Here, one can see various parameters that can be used to control, which frequency components are being used for reconstruction. All these parameters are passed to the <code>filterFrequencies</code> function from <a href="https://github.com/MagneticParticleImaging/MPIFiles.jl">MPIFiles.jl</a>.</p><p>The function <code>reconstructionSinglePatch</code> performs the frequency filtering and then calls</p><pre><code class="language-julia hljs">function reconstruction(bSF::MPIFile, bMeas::MPIFile, freq::Array;
  bEmpty = nothing, bgFrames = 1,  denoiseWeight = 0, redFactor = 0.0, thresh = nothing,
  loadasreal = false, solver = &quot;kaczmarz&quot;, sparseTrafo = nothing, saveTrafo=false,
  gridsize = gridSizeCommon(bSF), fov=calibFov(bSF), center=[0.0,0.0,0.0], useDFFoV=false,
  deadPixels=Int[], bgCorrectionInternal=false, kargs...)</code></pre><p>One can see that the frequency index is passed to this function as the third argument. All new keyword arguments are essentially used for determining the way how the system matrix is loaded. For instance with the parameters <code>gridsize</code>, <code>fov</code>, <code>center</code> it is possible to change the grid at which the system function is being loaded.</p><p>Once the system matrix is loaded, the next lower level function is called:</p><pre><code class="language-julia hljs">function reconstruction(S, bSF::MPIFile, bMeas::MPIFile, freq::Array, grid;
  frames = nothing, bEmpty = nothing, bgFrames = 1, nAverages = 1, numAverages=nAverages,
  sparseTrafo = nothing, loadasreal = false, maxload = 100, maskDFFOV=false,
  weightType=WeightingType.None, weightingLimit = 0, solver = &quot;kaczmarz&quot;,
  spectralCleaning=true, fgFrames=1:10, bgCorrectionInternal=false,
  noiseFreqThresh=0.0, kargs...)</code></pre><p>This function is responsible for loading the measurement data and potential background data that is subtracted from the measurements. For any frame to be reconstructed, the low level reconstruction routine is called.</p><h2 id="Low-Level-Reconstruction"><a class="docs-heading-anchor" href="#Low-Level-Reconstruction">Low Level Reconstruction</a><a id="Low-Level-Reconstruction-1"></a><a class="docs-heading-anchor-permalink" href="#Low-Level-Reconstruction" title="Permalink"></a></h2><p>Finally, we have arrived at the low level reconstruction routine that has the signature</p><pre><code class="language-julia hljs">function reconstruction(S, u::Array; sparseTrafo = nothing,
                        lambd=0, progress=nothing, solver = &quot;kaczmarz&quot;,
                        weights=nothing, kargs...)</code></pre><p>One can see that it requires the system matrix <code>S</code> and the measurements <code>u</code> to be already loaded.</p><p>We note that <code>S</code> is typeless for a reason here. For a regular reconstruction one will basically feed in an <code>Array{ComplexF32,2}</code> in here, although more precisely it will be a <code>Transposed</code> version of that type if the <code>Kaczmarz</code> algorithm is being used for efficiency reasons.</p><p>However, in case that matrix compression is applied <code>S</code> will be of type <code>SparseMatrixCSC</code>. And for <a href="multiPatch.html#Multi-Patch-Reconstruction">Multi-Patch Reconstruction</a> <code>S</code> will be of type <code>MultiPatchOperator</code>. Hence, the solvers are implemented in a very generic way and require only certain functions to be implemented. The low level reconstruction method calls one of the solvers from <a href="https://github.com/tknopp/RegularizedLeastSquares.jl">RegularizedLeastSquares.jl</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="overview.html">« Getting Started</a><a class="docs-footer-nextpage" href="parameters.html">Parameters »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Friday 14 October 2022 21:51">Friday 14 October 2022</span>. Using Julia version 1.8.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
